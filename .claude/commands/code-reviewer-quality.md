---
name: code-reviewer-quality
description: 专业代码质量审查与优化工具，支持代码异味识别、性能分析、安全检查和最佳实践验证。该命令专注于深度代码审查、错误调试分析、代码质量保证和改进建议，能够生成详细的审查报告、优化方案和重构指导，为开发团队提供完整的代码质量提升支持。
argument-hint: [代码/模块] [审查类型] [审查深度]
---

# 命令参数说明

- **代码/模块** (必需): 指定代码审查的目标，可以是：
  - **完整项目**: 对整个项目进行全面的代码审查
  - **特定模块**: 如 "用户认证模块"、"支付处理"、"数据访问层"等
  - **代码文件**: 指定具体的代码文件或文件路径
  - **功能特性**: 如 "性能关键代码"、"安全敏感模块"等
  - **重构目标**: 如 "遗留代码重构"、"技术债务清理"等

- **审查类型** (可选): 指定代码审查的类型和重点
  - **质量审查**: 代码质量、规范性和可维护性检查
  - **性能审查**: 性能瓶颈、资源使用和优化建议
  - **安全审查**: 安全漏洞、敏感数据处理和防护检查
  - **架构审查**: 代码结构、设计模式和架构合规性
  - **测试审查**: 测试覆盖率、测试质量和测试策略
  - **全面审查**: 包含所有类型的综合代码审查
  - **默认值**: 如未指定，默认为全面审查

- **审查深度** (可选): 指定代码审查的详细程度
  - **概要审查**: 高层次的代码质量检查和关键问题识别
  - **详细审查**: 深入的代码分析和具体改进建议
  - **深度审查**: 包含代码度量、复杂度分析和重构建议
  - **审计级审查**: 生产级别的全面审查和合规性检查
  - **默认值**: 如未指定，默认为详细审查

# 执行步骤

## 第一阶段：代码分析与准备
### 工具使用：sequential-thinking + memory + filesystem

1. **代码环境分析** (使用 sequential-thinking 工具)
   - 分析代码库的结构和组织方式
   - 确定编程语言、框架和技术栈
   - 评估代码规模和复杂度
   - 制定审查策略和检查清单

2. **质量标准建立** (使用 memory 工具)
   - 查询编程语言的最佳实践和编码规范
   - 确定代码质量度量标准和评估指标
   - 收集相关的行业标准和质量要求
   - 建立适合项目的质量基准

3. **审查范围界定** (使用 filesystem 工具)
   - 扫描和识别需要审查的代码文件
   - 分析代码依赖关系和影响范围
   - 确定审查的优先级和重点领域
   - 准备审查工具和分析环境

## 第二阶段：深度代码审查
### 工具使用：code-reviewer + senior-code-reviewer

1. **代码质量检查** (使用 code-reviewer Agent)
   - 识别代码异味和编程问题
   - 检查编码规范和命名约定
   - 分析代码复杂度和可读性
   - 评估代码的模块化和重用性

2. **安全性和合规性审查** (使用 senior-code-reviewer Agent)
   - 检查安全漏洞和敏感数据处理
   - 验证输入验证和数据校验
   - 分析权限控制和访问机制
   - 评估代码的合规性和风险管理

3. **性能和资源分析** (使用 senior-code-reviewer Agent)
   - 识别性能瓶颈和优化机会
   - 分析内存使用和资源管理
   - 检查并发处理和线程安全
   - 评估算法效率和数据结构选择

## 第三阶段：问题诊断与分析
### 工具使用：sequential-thinking + memory + code-reviewer

1. **问题分类和优先级** (使用 sequential-thinking 工具)
   - 对发现的问题进行分类和严重性评估
   - 制定问题修复的优先级和时间计划
   - 分析问题之间的依赖关系和影响
   - 设计问题解决的策略和方案

2. **根因分析** (使用 memory 工具)
   - 深入分析问题的根本原因
   - 查找类似问题的历史案例和解决方案
   - 评估修复方案的可行性和风险
   - 制定预防措施和长期改进策略

3. **改进方案设计** (使用 code-reviewer Agent)
   - 设计具体的代码修改和重构方案
   - 创建重构建议和最佳实践指导
   - 制定代码质量改进的实施计划
   - 提供工具和自动化改进建议

## 第四阶段：报告生成与指导
### 工具使用：design-doc-writer + sequential-thinking

1. **审查报告生成** (使用 design-doc-writer Agent)
   - 生成详细的代码审查报告
   - 创建问题清单和修复指导
   - 制作质量度量和趋势分析
   - 编写改进建议和最佳实践

2. **重构指导完善** (使用 sequential-thinking 工具)
   - 优化重构方案和实施步骤
   - 制定重构风险控制和质量保证措施
   - 设计重构验证和测试策略
   - 建立持续改进和监控机制

3. **知识沉淀与分享** (使用 sequential-thinking 工具)
   - 总结审查经验和最佳实践
   - 创建团队培训材料和知识库
   - 建立代码质量文化和标准
   - 制定长期质量改进计划

# Agent 与 MCP 工具指定

## 主要执行 Agent

### code-reviewer (主导 Agent)
- **使用阶段**: 第二阶段代码质量检查、第三阶段改进方案
- **核心职责**: 代码质量检查、错误识别、最佳实践验证、改进建议
- **专业能力**: 代码异味识别、性能分析、安全检查、标准化审查
- **主要工具**:
  - `sequential-thinking`: 代码质量分析、问题诊断、改进策略
  - `memory`: 质量标准查询、最佳实践库、问题模式识别
  - `filesystem`: 代码文件扫描、项目结构分析

### senior-code-reviewer (深度审查支持 Agent)
- **使用阶段**: 第二阶段安全性和性能审查
- **触发条件**: 需要深度安全审查或性能分析时
- **核心职责**: 深度代码审查、架构验证、性能瓶颈分析、安全风险评估
- **专业能力**: 高级代码分析、安全审计、性能优化、架构审查
- **主要工具**:
  - `sequential-thinking`: 深度问题分析、架构评估、性能优化建议
  - `memory`: 高级审查标准、安全模式库、性能基准查询

### design-doc-writer (文档生成支持 Agent)
- **使用阶段**: 第四阶段报告生成、文档完善
- **核心职责**: 审查报告撰写、文档标准化、内容组织
- **专业能力**: 技术文档写作、报告标准化、问题分析表达
- **主要工具**:
  - `filesystem`: 报告文档创建、编辑、格式处理
  - `sequential-thinking`: 报告结构设计、内容规划、质量优化
  - `memory`: 报告模板查询、标准格式应用

### software-architect (架构审查支持 Agent)
- **使用阶段**: 第二阶段架构审查、第三阶段重构指导
- **触发条件**: 需要架构层面的审查和建议时
- **核心职责**: 架构设计审查、设计模式验证、重构架构指导
- **专业能力**: 软件架构分析、设计模式应用、重构策略
- **主要工具**:
  - `sequential-thinking`: 架构分析、设计模式评估、重构策略制定
  - `memory`: 架构模式库、设计原则查询、重构案例研究

## MCP 工具使用策略

### 1. sequential-thinking 工具
- **使用时机**: 第一阶段代码分析、第三阶段问题诊断、第四阶段报告优化
- **具体用途**:
  - 深度分析代码结构和质量问题
  - 设计合理的问题分类和解决方案
  - 分析改进方案的可行性和效果
  - 优化报告结构和表达方式
- **思考深度**: 根据审查深度要求和代码复杂度调整分析深度

### 2. memory 工具
- **使用时机**: 第一阶段标准建立、第三阶段根因分析、全程知识支持
- **具体用途**:
  - 查询编程语言的编码规范和最佳实践
  - 收集常见代码问题和解决方案案例
  - 存储重要的审查发现和改进方案
  - 建立代码质量主题的知识库和案例库
- **记忆策略**: 为每个审查项目建立独立的问题知识图谱

### 3. filesystem 工具
- **使用时机**: 第一阶段代码扫描、第四阶段报告生成、全程文件管理
- **具体用途**:
  - 扫描和分析项目代码文件
  - 组织审查报告和文档文件
  - 管理相关的配置和脚本文件
  - 生成不同格式的审查输出文件
- **操作策略**: 遵循代码审查规范和文档管理标准

### 4. context7 工具
- **使用时机**: 第一阶段技术栈分析、第二阶段最佳实践查询
- **具体用途**:
  - 查询最新的编程语言标准和最佳实践
  - 获取相关框架和库的代码质量指南
  - 收集最新的代码审查工具和方法
  - 查询行业代码质量标准和度量方法
- **查询策略**: 使用编程语言+框架+质量标准进行查询

# 交付件说明

## 主要交付物清单

### 1. 代码审查报告 (Code Review Report)
**文件名格式**: `code_review_[项目名称]_[审查类型]_[日期].md`

**包含内容**:
- 完整的代码审查结果和发现
- 问题分类和严重性评估
- 具体的修复建议和改进方案
- 质量度量和趋势分析

**报告结构**:
```markdown
# 代码审查报告：[项目名称]

## 1. 审查概述
### 1.1 审查目标和范围
### 1.2 审查方法和工具
### 1.3 审查时间和参与人员
### 1.4 总体质量评估

## 2. 审查结果统计
### 2.1 问题分布统计
### 2.2 严重性分布
### 2.3 模块问题分布
### 2.4 质量指标分析

## 3. 关键问题发现
### 3.1 严重问题 (Critical)
- **问题1**: [问题描述]
  - **文件**: [文件路径:行号]
  - **严重性**: Critical/High/Medium/Low
  - **影响**: [影响描述]
  - **建议**: [修复建议]

### 3.2 高优先级问题 (High)
### 3.3 中等优先级问题 (Medium)
### 3.4 低优先级问题 (Low)

## 4. 质量度量分析
### 4.1 代码复杂度分析
### 4.2 重复代码分析
### 4.3 测试覆盖率分析
### 4.4 依赖关系分析

## 5. 改进建议
### 5.1 立即修复建议
### 5.2 短期改进计划
### 5.3 长期质量提升策略
### 5.4 团队培训建议

## 6. 最佳实践推荐
### 6.1 编码规范改进
### 6.2 工具和流程优化
### 6.3 代码质量文化建设
### 6.4 持续改进机制
```

### 2. 问题修复清单 (Issue Fix Checklist)
**文件名格式**: `fix_checklist_[项目名称]_[审查类型]_[日期].md`

**包含内容**:
- 详细的问题列表和修复步骤
- 代码修改示例和重构指导
- 修复验证和测试方法
- 修复优先级和时间安排

**清单结构**:
```markdown
# 问题修复清单：[项目名称]

## 立即修复 (Critical Issues)

### Issue 1: [问题标题]
- **文件**: [文件路径:行号]
- **问题描述**: [详细问题描述]
- **修复步骤**:
  1. [修复步骤1]
  2. [修复步骤2]
  3. [验证方法]
- **代码示例**:
  ```diff
  - [原代码]
  + [修复后代码]
  ```
- **测试用例**: [需要添加或修改的测试]

## 高优先级修复 (High Priority)

### Issue 2: [问题标题]
[类似结构]

## 中等优先级修复 (Medium Priority)
[类似结构]

## 低优先级修复 (Low Priority)
[类似结构]

## 修复进度跟踪
- **Critical**: [0/x] 已修复
- **High**: [0/x] 已修复
- **Medium**: [0/x] 已修复
- **Low**: [0/x] 已修复
```

### 3. 代码质量度量报告 (Quality Metrics Report)
**文件名格式**: `quality_metrics_[项目名称]_[日期].md`

**包含内容**:
- 详细的代码质量度量数据
- 质量趋势分析和对比
- 质量基线和目标设定
- 质量改进效果评估

**度量报告结构**:
```markdown
# 代码质量度量报告：[项目名称]

## 1. 质量指标概览
### 1.1 整体质量评分
### 1.2 与历史数据对比
### 1.3 行业基准对比
### 1.4 质量改进趋势

## 2. 详细度量数据
### 2.1 代码复杂度
- **圈复杂度**: 平均值/最大值/分布
- **认知复杂度**: 平均值/最大值/分布
- **嵌套深度**: 最大值/平均值

### 2.2 代码重复率
- **重复代码块数量**: [数量]
- **重复代码行数**: [行数]
- **重复率**: [百分比]
- **重复块分布**: [模块分布]

### 2.3 测试覆盖率
- **行覆盖率**: [百分比]
- **分支覆盖率**: [百分比]
- **函数覆盖率**: [百分比]
- **模块覆盖率分布**: [分布表]

### 2.4 技术债务
- **技术债务时间**: [小时]
- **技术债务成本**: [估算成本]
- **债务分布**: [模块分布]
- **债务优先级**: [优先级分布]

## 3. 质量趋势分析
### 3.1 时间序列分析
### 3.2 模块质量变化
### 3.3 问题类型趋势
### 3.4 改进效果评估

## 4. 质量目标和基线
### 4.1 质量目标设定
### 4.2 质量基线建立
### 4.3 监控指标定义
### 4.4 改进计划制定
```

### 4. 重构建议文档 (Refactoring Guide)
**文件名格式**: `refactoring_guide_[项目名称]_[日期].md`

**包含内容**:
- 详细的重构策略和实施指导
- 重构风险控制和验证方法
- 重构工具和自动化建议
- 重构效果评估和验收标准

**重构指导结构**:
```markdown
# 重构指导：[项目名称]

## 1. 重构策略
### 1.1 重构目标和原则
### 1.2 重构范围和优先级
### 1.3 重构风险评估
### 1.4 重构时间规划

## 2. 重构方案
### 2.1 架构重构
- **目标**: [重构目标]
- **方案**: [具体方案]
- **风险**: [风险分析]
- **验证**: [验证方法]

### 2.2 代码重构
- **方法提取重构**
- **类设计重构**
- **接口重构**
- **性能重构**

## 3. 重构实施
### 3.1 实施步骤
### 3.2 回滚策略
### 3.3 测试策略
### 3.4 质量保证

## 4. 重构工具
### 4.1 自动化重构工具
### 4.2 代码分析工具
### 4.3 测试工具
### 4.4 持续集成工具

## 5. 重构验收
### 5.1 验收标准
### 5.2 性能验证
### 5.3 质量验证
### 5.4 功能验证
```

### 5. 概要审查报告 (Executive Summary)
**文件名格式**: `review_summary_[项目名称]_概要_[日期].md`

**包含内容**:
- 高层次的审查结果和关键发现
- 主要质量问题和风险分析
- 核心改进建议和行动计划
- 质量改进的预期效果

**概要报告结构**:
```markdown
# 代码审查概要：[项目名称]

## 1. 执行摘要
### 1.1 审查概况
### 1.2 主要发现
### 1.3 质量评估
### 1.4 关键建议

## 2. 关键问题
### 2.1 严重问题概述
### 2.2 风险分析
### 2.3 影响评估
### 2.4 紧急行动项

## 3. 质量状况
### 3.1 质量评分
### 3.2 主要指标
### 3.3 行业对比
### 3.4 改进潜力

## 4. 改进计划
### 4.1 短期计划
### 4.2 中期计划
### 4.3 长期规划
### 4.4 资源需求

## 5. 下一步行动
### 5.1 立即行动
### 5.2 团队协调
### 5.3 工具配置
### 5.4 培训安排
```

## 实时审查支持

### 审查进度跟踪
**实时输出**: 在对话中提供实时的代码审查进度和关键发现

**包含内容**:
- 当前审查阶段和完成进度
- 重要质量问题的发现状态
- 遇到的技术挑战和分析结果
- 下一步审查内容和重点领域

**输出格式**:
```markdown
## 🔍 代码审查进度报告
**当前阶段**: [具体审查阶段]
**完成度**: [百分比]%
**审查类型**: [代码审查类型]

## 📊 审查发现状态
- **已审查文件**: [已审查的文件数量]
- **发现问题**: [发现的问题总数]
- **严重问题**: [严重问题数量]
- **进行中分析**: [正在分析的模块]

## 🎯 关键质量问题
- **代码异味**: [发现的代码异味类型]
- **安全漏洞**: [发现的安全问题]
- **性能瓶颈**: [识别的性能问题]
- **设计问题**: [架构和设计层面问题]

## 📋 下一步计划
1. [下一步要审查的模块或文件]
2. [需要重点关注的质量问题]
3. [需要深入分析的技术债务]
4. [需要补充的验证和测试]
```

# 约束与限制条件

## 审查内容约束

### 专业性约束
- **审查准确性**: 确保代码审查结果的准确性和专业性
- **标准合规**: 遵循行业代码审查标准和最佳实践
- **客观公正**: 保持审查的客观性和公正性
- **建设性**: 提供建设性的改进建议和指导

### 完整性约束
- **覆盖完整**: 确保审查覆盖所有重要的代码质量维度
- **问题全面**: 全面识别各类代码质量和安全问题
- **建议具体**: 提供具体可执行的改进建议
- **文档完整**: 提供完整的审查文档和跟踪记录

### 时效性约束
- **及时反馈**: 及时提供审查结果和改进建议
- **优先级明确**: 明确问题修复的优先级和时间要求
- **持续监控**: 建立持续的质量监控和改进机制
- **趋势分析**: 关注质量变化趋势和改进效果

## 技术约束条件

### 工具和方法约束
- **工具支持**: 依赖静态代码分析工具和质量度量工具
- **方法标准**: 使用标准化的审查方法和检查清单
- **度量基准**: 建立合适的质量度量基准和目标
- **自动化程度**: 平衡自动化审查和人工审查的比例

### 技能和经验约束
- **技术能力**: 需要具备多语言和多种技术栈的审查能力
- **业务理解**: 需要理解业务逻辑和领域知识
- **架构视野**: 需要具备系统架构和设计模式的理解
- **安全意识**: 需要具备代码安全审查的专业知识

### 环境和资源约束
- **时间限制**: 在合理的时间内完成审查工作
- **资源限制**: 考虑审查工具和计算资源的限制
- **访问权限**: 考虑代码访问权限和安全约束
- **团队配合**: 需要开发团队的配合和支持

## 使用约束条件

### 审查范围约束
- **目标明确**: 审查目标和范围必须明确界定
- **标准一致**: 使用一致的审查标准和评估方法
- **重点突出**: 突出重点问题和关键改进领域
- **可操作性**: 提供可操作的改进建议和实施指导

### 应用场景约束
- **项目适配**: 审查结果需要适配具体项目特点
- **团队适配**: 考虑开发团队的技能水平和工作方式
- **阶段适配**: 根据项目阶段调整审查重点和方法
- **质量适配**: 设定适合的质量标准和改进目标

### 结果使用约束
- **责任明确**: 明确问题修复的责任人和时间要求
- **跟踪验证**: 建立问题修复的跟踪和验证机制
- **持续改进**: 建立持续的质量改进和监控机制
- **知识分享**: 促进审查经验和最佳实践的分享

## 伦理约束条件

### 专业责任约束
- **质量承诺**: 对审查质量承担专业责任
- **持续学习**: 持续学习新的审查技术和工具
- **客观公正**: 保持客观公正的审查态度
- **建设性沟通**: 采用建设性的沟通方式反馈问题

### 知识产权约束
- **代码保密**: 保护代码的机密性和知识产权
- **合理使用**: 合理使用代码审查工具和资源
- **引用规范**: 遵循知识产权引用规范
- **合规操作**: 确保审查过程的合规性

# 使用场景与最佳实践

## 适用场景

### 开发阶段审查
- **功能开发**: 新功能代码的质量审查
- **重构代码**: 重构工作的审查和验证
- **集成开发**: 模块集成时的接口和协议审查
- **性能优化**: 性能关键代码的优化审查

### 发布前审查
- **版本发布**: 版本发布前的全面质量审查
- **安全审计**: 安全敏感功能的安全审查
- **性能验收**: 性能要求的验收审查
- **合规检查**: 行业合规性要求的检查

### 维护阶段审查
- **问题修复**: 问题修复代码的审查
- **技术债务**: 技术债务清理的规划和审查
- **遗留系统**: 遗留代码的现代化改造审查
- **安全更新**: 安全补丁和更新的审查

### 团队能力提升
- **代码培训**: 团队代码质量培训的素材
- **最佳实践**: 最佳实践的推广和应用
- **标准建立**: 团队编码标准的建立和维护
- **知识分享**: 代码质量知识的分享和传承

## 不适用场景

### 需求分析
- **业务需求**: 不进行业务需求的分析和评估
- **功能设计**: 不替代功能设计和用户体验设计
- **架构设计**: 不进行系统架构的设计和决策
- **技术选型**: 不进行技术选型的分析和决策

### 项目管理
- **项目规划**: 不进行项目规划和进度管理
- **团队管理**: 不涉及团队组织和人员管理
- **资源配置**: 不进行资源配置和预算管理
- **风险管理**: 不替代全面的项目风险管理

### 运维部署
- **系统运维**: 不进行系统运维和监控
- **部署管理**: 不涉及部署配置和环境管理
- **性能监控**: 不进行实时的性能监控和优化
- **安全运维**: 不替代专业的安全运维管理

## 最佳实践指南

### 审查流程优化

#### 审查准备
- **目标明确**: 明确审查目标和范围
- **工具准备**: 准备适当的审查工具和环境
- **标准制定**: 制定一致的审查标准和评估方法
- **团队协调**: 协调开发团队的参与和配合

#### 审查执行
- **系统化审查**: 采用系统化的审查方法和流程
- **问题分类**: 对问题进行合理的分类和优先级排序
- **证据收集**: 收集充分的问题证据和分析数据
- **建议具体**: 提供具体可执行的改进建议

### 质量改进优化

#### 问题修复
- **优先级管理**: 根据问题严重性制定修复优先级
- **跟踪验证**: 建立问题修复的跟踪和验证机制
- **根因分析**: 进行问题根因分析防止重复发生
- **预防措施**: 制定预防措施和质量保证机制

#### 持续改进
- **度量监控**: 建立质量度量和持续监控机制
- **趋势分析**: 分析质量变化趋势和改进效果
- **最佳实践**: 总结和推广代码质量最佳实践
- **培训教育**: 进行团队质量意识培训

### 团队协作优化

#### 沟通机制
- **建设性反馈**: 提供建设性的质量反馈和改进建议
- **知识分享**: 促进质量知识和经验的分享
- **标准统一**: 建立团队统一的质量标准和规范
- **文化建设**: 培养团队的质量文化意识

#### 工具支持
- **自动化工具**: 使用自动化代码审查工具提高效率
- **集成平台**: 建立代码审查的集成平台和流程
- **度量仪表板**: 建立质量度量的可视化仪表板
- **知识库**: 建立质量知识库和案例库

# 命令执行限制说明

**重要提醒**: 此命令专注于专业的代码质量审查和改进指导，不涉及具体的代码实现、架构设计或项目管理。如需要以下服务，请使用对应的专业命令：

- **代码实现**: 使用 `software-developer-guide` 命令进行代码实现
- **架构设计**: 使用 `software-architect-design` 命令进行架构设计
- **需求分析**: 使用 `software-requirements-analysis` 命令进行需求分析
- **技术选型**: 使用 `tech-selection-analysis` 命令进行技术选型
- **DevOps支持**: 使用 `devops-engineer` 命令进行部署和运维
- **系统设计**: 使用 `system-designer` 命令进行创意系统设计