---
name: explain-code
description: 智能代码解释器
argument-hint: "[代码位置或代码片段]"
---

## 功能说明

智能分析并解释指定代码的功能、逻辑和实现原理，支持逐行解析和上下文关联说明。

## 执行步骤

1. **参数验证**：
   - 检查用户是否提供了代码位置或代码片段参数
   - 如未提供参数，提示用户输入需要解释的代码位置或直接粘贴代码

2. **并行代码复杂度评估和Agent选择**：
   - **并行代码初步分析**（同时进行多维度分析）:
     * **代码获取组**（并行执行）:
       - Explore工具快速定位用户指定的代码位置或处理粘贴的代码片段
       - filesystem工具读取相关的项目文件和依赖关系
       - ide工具获取实时的代码诊断信息和语法检查
     * **复杂度评估组**（并行执行）:
       - 代码行数和结构复杂度分析
       - 功能模块数量和依赖关系分析
       - 技术栈和领域特征识别
   - **智能复杂度判断**: 根据并行分析结果智能选择合适的分析agent
     * **简单代码**（<50行，单一功能）: 使用local-developer进行快速分析
     * **中等复杂代码**（50-200行，多个函数）: 使用local-developer + senior-code-reviewer组合
     * **复杂代码**（>200行，复杂逻辑）: 使用senior-code-reviewer + 相关领域专家组合
     * **特定领域代码**: 根据技术栈选择专门的领域专家

3. **并行Agent协调代码深度分析**：
   - **并行分析执行**（根据复杂度同时启动多个agent进行全面分析）:
     * **基础分析组**（并行执行）:
       - Task工具启动local-developer(qwen3-coder:30b)进行高效的代码分析和解释
         - 分析代码的语法结构、逻辑流程和依赖关系
         - 识别代码的设计模式和编程技巧
         - 提供清晰易懂的代码解释和使用说明
       - sequential-thinking工具进行逻辑推理和流程分析
     * **专业分析组**（复杂代码时并行启动）:
       - Task工具启动senior-code-reviewer代理进行专业代码分析
         - 深度分析代码的架构设计和实现原理
         - 识别复杂的设计模式和高级编程技巧
         - 评估代码质量和潜在改进点
       - 根据代码类型并行启动相应的专业领域agent:
         * **Godot相关代码**: godot-game-developer或godot-architect进行专业分析
         * **Web性能代码**: web-performance-analyst分析性能相关问题
         * **算法复杂代码**: senior-code-reviewer进行算法效率和复杂度分析
         * **架构级代码**: 相关架构专家进行架构层面分析
     * **辅助分析组**（需要时并行启动）:
       - context7获取相关的技术文档和最佳实践
       - tavily-mcp搜索类似代码的实现案例和解决方案
       - ai-model-advisor进行多角度验证（特别重要的代码）

4. **并行多维度智能解释整合**：
   - **并行解释生成组**（同时生成多角度解释）:
     * **功能解释**: 基于所有agent的分析结果，提供代码主要功能的简明概述
     * **架构解释**: 如涉及架构设计，解释代码在整体架构中的作用和设计意图
     * **实现解释**: 提供逐行或逐代码段的详细技术解释
     * **模式解释**: 识别并解释代码中使用的设计模式和编程技巧
     * **性能安全解释**: 分析代码的性能特点和潜在的安全考虑
     * **最佳实践对比**: 将代码实现与业界最佳实践进行对比分析
   - **sequential-thinking工具整合**: 整合所有并行解释结果，形成连贯的代码解释文档

5. **并行上下文关联与影响分析**：
   - **并行关联分析组**（同时分析多个维度）:
     * **项目集成分析**: 说明代码与项目其他部分的集成关系
     * **依赖关系分析**: 分析代码的依赖关系和影响范围
     * **扩展性评估**: 评估代码的可扩展性和维护性
     * **使用场景分析**: 提供代码的具体使用场景和调用示例
     * **影响范围评估**: 分析代码变更可能影响的其他模块
   - **知识关联建立**: 建立代码与相关技术知识的关联

6. **并行智能优化建议生成**：
   - **并行建议生成组**（同时生成多类型优化建议）:
     * **基础优化建议**: local-developer提供基础优化建议和最佳实践
     * **质量改进建议**: 基于负责分析的agent提供相应的代码质量改进建议
     * **架构优化建议**: 如适用，提供godot-architect的架构优化建议
     * **性能提升建议**: 提供具体的性能优化方案和实现建议
     * **最佳实践建议**: 推荐相关的编程最佳实践和设计模式
     * **成本优化建议**: 对于优化建议，使用local-developer生成具体的代码实现示例
   - **建议整合优化**: sequential-thinking工具整合所有优化建议，按优先级排序

7. **并行知识沉淀与文档化**：
   - **并行知识处理组**（同时进行多维度知识处理）:
     * **解释记录**: 将详细的代码解释记录到memory中供后续参考
     * **模式提取**: 提取代码中的有用模式和技巧
     * **学习资源收集**: 使用context7获取相关的学习资源和技术文档
     * **关联知识建立**: 建立代码与相关技术知识的关联
     * **案例库更新**: 将分析结果添加到相关代码案例库中

8. **结构化输出与交互优化**：
   - **分层展示**: 按照理解层次组织解释内容（概述→详细→深度）
   - **可视化支持**: 为复杂逻辑提供流程图或时序图
   - **交互式解释**: 允许用户就特定部分请求更深入的解释
   - **实践建议**: 提供实际应用和练习建议
