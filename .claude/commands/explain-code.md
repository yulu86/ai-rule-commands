---
name: explain-code
description: 智能代码解释器
argument-hint: "[代码位置或代码片段]"
---

## 功能说明

智能分析并解释指定代码的功能、逻辑和实现原理，支持逐行解析和上下文关联说明。

## 执行步骤

1. **参数验证**：
   - 检查用户是否提供了代码位置或代码片段参数
   - 如未提供参数，提示用户输入需要解释的代码位置或直接粘贴代码

2. **代码复杂度评估和Agent选择**：
   - **代码初步分析**: 使用Explore工具和filesystem快速获取代码内容
   - **复杂度判断**: 根据以下标准智能选择合适的分析agent
     * **简单代码（<50行，单一功能）**: 使用local-developer进行快速分析
     * **中等复杂代码（50-200行，多个函数）**: 使用local-developer + senior-code-reviewer组合
     * **复杂代码（>200行，复杂逻辑）**: 使用senior-code-reviewer + 相关领域专家组合
     * **特定领域代码**: 根据技术栈选择专门的领域专家

3. **Agent协调代码获取与分析**：
   - **代码定位**: 使用Explore工具快速定位用户指定的代码位置或处理粘贴的代码片段
   - **上下文分析**: 使用filesystem工具读取相关的项目文件和依赖关系
   - **语法诊断**: 使用ide工具获取实时的代码诊断信息和语法检查
   - **智能分析执行**: 根据复杂度评估结果选择合适的分析策略
     * **简单代码分析**: 使用Task工具启动local-developer(qwen3-coder:30b)进行高效的代码分析和解释
       - 分析代码的语法结构、逻辑流程和依赖关系
       - 识别代码的设计模式和编程技巧
       - 提供清晰易懂的代码解释和使用说明
     * **复杂代码分析**: 使用Task工具启动senior-code-reviewer代理进行专业代码分析
       - 深度分析代码的架构设计和实现原理
       - 识别复杂的设计模式和高级编程技巧
       - 评估代码质量和潜在改进点
   - **技术深度分析**: 根据代码类型和复杂度启动相应的专业领域agent
     * **Godot相关代码**: 启动godot-game-developer或godot-architect进行专业分析
     * **Web性能代码**: 启动web-performance-analyst分析性能相关问题
     * **算法复杂代码**: 启动senior-code-reviewer进行算法效率和复杂度分析
     * **架构级代码**: 启动相关架构专家进行架构层面分析
   - **多模型验证**: 对于特别复杂或重要的代码，使用ai-model-advisor进行多角度验证

3. **多维度智能解释**：
   - **总体功能概述**: 基于所有agent的分析结果，提供代码主要功能的简明概述
   - **架构层面解释**: 如涉及架构设计，解释代码在整体架构中的作用和设计意图
   - **实现细节解析**: 提供逐行或逐代码段的详细技术解释
   - **设计模式识别**: 识别并解释代码中使用的设计模式和编程技巧
   - **性能和安全分析**: 分析代码的性能特点和潜在的安全考虑
   - **最佳实践对比**: 将代码实现与业界最佳实践进行对比分析

4. **上下文关联与影响分析**：
   - **项目集成**: 说明代码与项目其他部分的集成关系
   - **依赖管理**: 分析代码的依赖关系和影响范围
   - **扩展性评估**: 评估代码的可扩展性和维护性
   - **使用场景**: 提供代码的具体使用场景和调用示例

5. **智能优化建议生成**：
   - **基于复杂度的建议策略**:
     * **简单代码**: local-developer提供基础优化建议和最佳实践
     * **中等复杂代码**: local-developer + senior-code-reviewer协作提供深度优化建议
     * **复杂代码**: 多个专家agent协作提供全面的优化方案
   - **质量改进**: 基于负责分析的agent提供相应的代码质量改进建议
   - **架构优化**: 如适用，提供godot-architect的架构优化建议
   - **性能提升**: 提供具体的性能优化方案和实现建议
   - **最佳实践**: 推荐相关的编程最佳实践和设计模式
   - **成本优化**: 对于优化建议，使用local-developer生成具体的代码实现示例

6. **知识沉淀与文档化**：
   - **解释记录**: 将详细的代码解释记录到memory中供后续参考
   - **模式提取**: 提取代码中的有用模式和技巧
   - **学习资源**: 使用context7获取相关的学习资源和技术文档
   - **关联知识**: 建立代码与相关技术知识的关联

7. **结构化输出与交互优化**：
   - **分层展示**: 按照理解层次组织解释内容（概述→详细→深度）
   - **可视化支持**: 为复杂逻辑提供流程图或时序图
   - **交互式解释**: 允许用户就特定部分请求更深入的解释
   - **实践建议**: 提供实际应用和练习建议
