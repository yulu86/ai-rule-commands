---
name: godot-debug
description: 专门用于诊断和修复Godot项目中的代码问题，系统化调试流程。该命令整合了Godot引擎的专业调试技术，提供从问题定位到解决方案的完整调试支持，包含错误分析、性能诊断、逻辑排查和修复验证的全流程服务。
argument-hint: [问题描述]
---

# 命令参数说明

- **问题描述** (必需): 详细描述遇到的问题，包含以下要素：
  - **问题类型**: 错误信息、异常行为、性能问题、逻辑错误等
  - **出现场景**: 什么情况下会出现问题
  - **错误信息**: 完整的错误日志和堆栈跟踪
  - **期望行为**: 描述正确的预期行为
  - **重现步骤**: 如何重现该问题的具体步骤
  - **环境信息**: Godot版本、目标平台等相关信息

# 执行步骤

**当前调试问题**: $ARGUMENTS

## 第一阶段：问题收集与初步诊断
### 工具使用：godot + filesystem + sequential-thinking

1. **环境信息收集** (使用 godot 工具)
   - 获取Godot版本和项目配置信息
   - 检查项目的运行状态和调试输出
   - 分析项目的节点结构和场景组织
   - 针对 **$1** 问题收集相关的资源文件和脚本信息

2. **错误信息分析** (使用 filesystem 工具)
   - 读取并分析 **$1** 相关的错误日志文件
   - 检查相关的脚本文件和场景文件
   - 分析项目配置和设置文件
   - 收集 **$1** 问题的调试信息和状态数据

3. **问题分类与优先级评估** (使用 sequential-thinking 工具)
   - 分析 **$1** 问题的类型和严重程度
   - 评估问题的紧急性和影响范围
   - 确定调试的优先级和策略
   - 制定针对 **$1** 的系统化调试计划

## 第二阶段：深度问题诊断
### 工具使用：godot + sequential-thinking + memory

1. **运行时调试** (使用 godot 工具)
   - 运行项目并实时监控调试输出
   - 捕获运行时错误和异常信息
   - 分析性能指标和资源使用情况
   - 观察游戏行为和状态变化

2. **代码逻辑分析** (使用 sequential-thinking 工具)
   - 分析相关脚本的执行逻辑
   - 检查变量值和程序流程
   - 识别逻辑错误和算法问题
   - 分析代码间的依赖和交互关系

3. **系统状态诊断** (使用 memory 工具)
   - 查询Godot常见问题解决方案
   - 检查系统配置和环境设置
   - 分析可能的根本原因
   - 收集相关的调试技术和最佳实践

## 第三阶段：解决方案制定
### 工具使用：sequential-thinking + memory + tavily-mcp

1. **根本原因分析** (使用 sequential-thinking 工具)
   - 深入分析问题的根本原因
   - 评估不同解决方案的可行性
   - 分析解决方案的优缺点和风险
   - 确定最佳的修复策略

2. **解决方案设计** (使用 memory 工具)
   - 设计具体的解决方案和实施步骤
   - 查询相关的技术文档和最佳实践
   - 分析解决方案的兼容性和扩展性
   - 制定测试和验证计划

3. **技术验证** (使用 tavily-mcp 工具)
   - 搜索相似问题的解决方案
   - 查询最新的技术发展和修复方案
   - 验证解决方案的技术可行性
   - 收集相关的案例和经验分享

## 第四阶段：修复实施与验证
### 工具使用：filesystem + godot + sequential-thinking

1. **修复方案实施** (使用 filesystem 工具)
   - 修改相关的脚本文件和配置
   - 更新场景文件和资源设置
   - 实施代码重构和优化
   - 创建修复补丁和备份

2. **修复效果验证** (使用 godot 工具)
   - 运行修复后的项目进行测试
   - 监控调试输出和性能指标
   - 验证问题是否得到解决
   - 检查是否引入新的问题

3. **回归测试与优化** (使用 sequential-thinking 工具)
   - 进行全面的回归测试
   - 分析修复对系统的影响
   - 优化相关的性能和稳定性
   - 完善相关的文档和注释

# Agent 与 MCP 工具指定

## 主要执行 Agent

### godot-code-reviewer (主导 Agent)
- **使用阶段**: 第二阶段和第三阶段
- **核心职责**: 专业代码审查、错误调试分析、代码质量保证
- **专业能力**: GDScript语法分析、Godot API使用检查、性能瓶颈识别、错误模式识别
- **主要工具**:
  - `godot`: 项目运行、调试输出获取、状态监控
  - `sequential-thinking`: 复杂问题分析和解决方案设计
  - `memory`: 常见问题查询和最佳实践应用

### godot-architect (技术架构支持 Agent)
- **使用阶段**: 第三阶段解决方案设计
- **触发条件**: 问题涉及架构设计或系统重构时
- **核心职责**: 架构问题诊断、系统设计优化、技术方案评估
- **专业能力**: 场景结构设计、节点架构优化、系统性能分析
- **主要工具**:
  - `sequential-thinking`: 架构问题分析和设计决策
  - `memory`: Godot架构模式和最佳实践查询

### godot-game-developer (实施支持 Agent)
- **使用阶段**: 第四阶段修复实施
- **触发条件**: 需要修改代码或实施修复方案时
- **核心职责**: 代码修改实施、功能测试验证、性能优化
- **专业能力**: GDScript编程、场景编辑、资源管理、性能调优
- **主要工具**:
  - `filesystem`: 代码文件修改和配置更新
  - `godot`: 项目测试运行和状态验证

## MCP 工具使用策略

### 1. godot 工具
- **使用时机**: 第一阶段环境收集、第二阶段运行调试、第四阶段验证测试
- **具体用途**:
  - `get_project_info`: 获取项目元数据和配置信息
  - `run_project`: 运行项目并监控调试输出
  - `get_debug_output`: 获取实时的调试信息和错误日志
  - `get_godot_version`: 确认Godot版本和环境兼容性
- **操作策略**: 结合多种调试手段，全面收集运行时信息

### 2. filesystem 工具
- **使用时机**: 第一阶段信息收集、第四阶段修复实施
- **具体用途**:
  - `read_multiple_files`: 批量读取相关的脚本和配置文件
  - `search_files`: 查找包含特定错误信息的文件
  - `edit_file`: 修改代码文件和配置设置
  - `directory_tree`: 分析项目的整体文件结构
- **操作策略**: 系统化地检查和修改相关文件

### 3. sequential-thinking 工具
- **使用时机**: 第一阶段问题分析、第二阶段深度诊断、第三阶段方案设计
- **具体用途**:
  - 逐步分析复杂问题的因果关系
  - 设计系统化的调试流程和策略
  - 评估不同解决方案的优劣
  - 制定全面的测试和验证计划
- **思考深度**: 根据问题复杂度调整分析深度和广度

### 4. memory 工具
- **使用时机**: 全程知识支持和最佳实践查询
- **具体用途**:
  - 存储和分析常见Godot问题模式
  - 查询Godot调试技术和解决方案
  - 记录项目的特定配置和约束条件
  - 建立问题类型和解决方案的关联
- **记忆策略**: 为每个问题建立独立的诊断实体

### 5. tavily-mcp 工具
- **使用时机**: 第三阶段技术验证和方案完善
- **具体用途**:
  - 搜索特定错误的解决方案和技术文档
  - 查询最新的Godot版本更新和修复说明
  - 收集社区经验和最佳实践分享
  - 验证解决方案的技术可行性
- **搜索策略**: 使用错误关键词+Godot版本进行精准搜索

# 交付件说明

## 主要交付物清单

### 1. 问题诊断报告 (Problem Diagnosis Report)
**文件名格式**: `debug_diagnosis_[问题类型]_[日期].md`

**包含内容**:
- 问题描述和环境信息
- 问题分类和严重程度评估
- 初步诊断和可能原因分析
- 调试策略和实施计划

**文档结构**:
```markdown
# Godot问题诊断报告：[问题描述]

## 1. 问题基本信息
- **问题描述**: [详细问题描述]
- **问题类型**: [错误/性能/逻辑等]
- **严重程度**: [高/中/低]
- **影响范围**: [影响的功能模块]

## 2. 环境信息
- **Godot版本**: [具体版本]
- **目标平台**: [PC/Mobile/Web等]
- **项目配置**: [相关配置信息]

## 3. 初步诊断
### 3.1 问题分类
### 3.2 可能原因分析
### 3.3 调试策略
```

### 2. 深度调试分析报告 (Deep Debug Analysis)
**文件名格式**: `debug_analysis_[问题ID]_[日期].md`

**包含内容**:
- 详细的根因分析结果
- 代码执行流程和状态分析
- 系统性能和资源使用分析
- 问题复现步骤和测试结果

**文档结构**:
```markdown
# 深度调试分析报告：[问题ID]

## 1. 根因分析
### 1.1 直接原因
### 1.2 间接原因
### 1.3 根本原因

## 2. 代码执行分析
### 2.1 执行流程图
### 2.2 关键变量状态
### 2.3 异常行为分析

## 3. 系统状态分析
### 3.1 性能指标
### 3.2 资源使用情况
### 3.3 系统日志分析
```

### 3. 解决方案设计文档 (Solution Design)
**文件名格式**: `solution_design_[问题ID]_[日期].md`

**包含内容**:
- 详细的问题解决方案
- 实施步骤和时间计划
- 风险评估和应对策略
- 测试验证和回归测试计划

**文档结构**:
```markdown
# 解决方案设计：[问题ID]

## 1. 解决方案概述
### 1.1 解决策略
### 1.2 技术方案
### 1.3 预期效果

## 2. 实施计划
### 2.1 修复步骤
### 2.2 时间安排
### 2.3 资源需求

## 3. 风险评估
### 3.1 技术风险
### 3.2 实施风险
### 3.3 应对策略

## 4. 测试计划
### 4.1 功能测试
### 4.2 性能测试
### 4.3 回归测试
```

### 4. 修复实施记录 (Fix Implementation Log)
**文件名格式**: `fix_implementation_[问题ID]_[日期].md`

**包含内容**:
- 具体的代码修改记录
- 文件变更和版本控制信息
- 测试结果和验证数据
- 修复效果的量化评估

**文档结构**:
```markdown
# 修复实施记录：[问题ID]

## 1. 代码修改记录
### 1.1 修改文件列表
### 1.2 具体修改内容
### 1.3 版本控制信息

## 2. 测试验证结果
### 2.1 功能测试结果
### 2.2 性能测试数据
### 2.3 稳定性测试

## 3. 修复效果评估
### 3.1 问题解决情况
### 3.2 性能改善数据
### 3.3 副作用分析
```

### 5. 调试知识库更新 (Debug Knowledge Base)
**文件名格式**: `debug_knowledge_[问题类型]_[日期].md`

**包含内容**:
- 问题类型和解决方案总结
- 调试技术和最佳实践
- 预防措施和改进建议
- 相关知识点和参考资料

**文档结构**:
```markdown
# 调试知识库：[问题类型]

## 1. 问题模式识别
### 1.1 常见症状
### 1.2 触发条件
### 1.3 诊断方法

## 2. 解决方案库
### 2.1 标准解决方案
### 2.2 变种问题处理
### 2.3 预防措施

## 3. 最佳实践
### 3.1 调试技巧
### 3.2 工具使用方法
### 3.3 效率提升建议
```

## 实时调试支持

### 调试会话记录
**实时输出**: 在对话中提供结构化的调试指导

**包含内容**:
- 当前调试阶段和进度
- 即时发现的问题和观察
- 下一步调试建议
- 实时的解决方案调整

**输出格式**:
```markdown
## 🔍 调试进度报告
**当前阶段**: [具体阶段名称]
**完成度**: [百分比]%
**关键发现**: [重要发现]

## ⚡ 即时观察
- **现象**: [观察到的现象]
- **分析**: [初步分析结果]
- **影响**: [对系统的影响]

## 🎯 下一步建议
1. [具体的调试步骤]
2. [需要检查的文件或功能]
3. [验证方法和期望结果]

## 🔄 方案调整
[根据新发现调整调试策略]
```

# 约束与限制条件

## 调试范围约束

### 问题类型约束
- **技术问题**: 专注于技术实现和代码问题
- **性能问题**: 可分析和优化性能相关问题
- **逻辑错误**: 可调试游戏逻辑和算法问题
- **配置问题**: 可诊断项目配置和设置问题

### 复杂度约束
- **分析深度**: 根据问题复杂度控制分析深度
- **时间成本**: 调试时间控制在合理范围内
- **资源需求**: 考虑调试所需的计算和存储资源
- **影响范围**: 评估调试对项目正常运行的影响

### 环境约束
- **版本兼容**: 考虑不同Godot版本的兼容性问题
- **平台差异**: 分析跨平台实现时的差异和问题
- **硬件限制**: 考虑目标硬件平台的限制条件
- **网络环境**: 如涉及网络功能，考虑网络环境影响

## 技术约束条件

### 调试工具约束
- **工具限制**: 受限于当前可用的调试工具和功能
- **信息获取**: 只能获取程序愿意暴露的调试信息
- **实时性**: 实时调试的性能开销和准确性平衡
- **干扰性**: 调试过程可能影响程序的正常行为

### 分析精度约束
- **静态分析**: 静态代码分析的局限性
- **动态行为**: 运行时行为的预测和分析难度
- **并发问题**: 多线程和并发问题的复杂性
- **外部依赖**: 外部服务和库的行为不可控性

### 解决方案约束
- **修改风险**: 代码修改可能引入新问题
- **兼容性**: 解决方案的向后兼容性
- **性能影响**: 修复方案对性能的潜在影响
- **维护成本**: 解决方案的长期维护成本

## 使用约束条件

### 信息提供约束
- **描述准确性**: 用户问题描述的准确性和完整性
- **重现条件**: 问题的可重现性和稳定的复现步骤
- **环境信息**: 完整的运行环境和配置信息
- **权限限制**: 对项目文件和资源的访问权限

### 调试过程约束
- **交互频率**: 调试过程中的交互频率和响应时间
- **决策参与**: 需要用户参与的决策点和选择
- **风险承担**: 调试过程中的潜在风险和损失承担
- **进度控制**: 调试进度的控制和优先级调整

### 结果应用约束
- **测试验证**: 修复方案的充分测试和验证责任
- **备份策略**: 调试前的数据备份和版本控制
- **部署决策**: 修复方案的正式部署和应用决策
- **效果评估**: 修复效果的客观评估和反馈

## 伦理约束条件

### 数据安全约束
- **隐私保护**: 保护项目中的敏感数据和商业机密
- **代码安全**: 确保调试过程不会泄露代码安全信息
- **访问控制**: 遵守项目的访问控制和安全策略
- **数据完整性**: 保证调试过程中数据的完整性和一致性

### 专业操守约束
- **责任边界**: 明确调试责任和用户责任的边界
- **能力限制**: 承认技术能力的限制和不足
- **透明度**: 对调试过程和结果保持透明
- **持续改进**: 基于反馈持续改进调试能力

# 使用场景与最佳实践

## 适用场景

### 开发阶段调试
- **功能开发**: 新功能开发过程中的问题调试
- **集成测试**: 模块集成时的兼容性和交互问题
- **性能优化**: 代码性能分析和优化建议
- **架构调整**: 系统架构变更时的相关问题

### 测试阶段调试
- **Bug修复**: 测试发现的Bug和错误修复
- **兼容性测试**: 不同平台和设备的兼容性问题
- **压力测试**: 高负载下的性能和稳定性问题
- **用户体验**: 用户体验相关的问题和改进

### 维护阶段调试
- **线上问题**: 生产环境出现的问题和故障
- **版本升级**: 版本升级过程中的兼容性和迁移问题
- **性能衰退**: 长期运行后的性能衰退和优化需求
- **安全加固**: 安全漏洞和威胁的修复和防护

### 学习研究场景
- **技术调研**: 新技术和实现方式的学习和调研
- **问题研究**: 深入研究特定类型问题的解决方案
- **最佳实践**: 调试最佳实践和经验总结
- **工具使用**: 调试工具和技术的学习和应用

## 不适用场景

### 非技术问题
- **产品设计**: 产品功能设计和用户体验问题
- **项目管理**: 项目进度、资源和团队管理问题
- **商业决策**: 商业策略和市场定位问题
- **法律合规**: 法律法规和合规性问题

### 硬件相关问题
- **设备故障**: 硬件设备本身的故障和损坏
- **驱动问题**: 操作系统和驱动程序的问题
- **网络故障**: 网络设备和连接的问题
- **环境问题**: 运行环境的物理和环境问题

### 恶意代码分析
- **病毒分析**: 恶意软件和病毒的分析和清除
- **安全攻击**: 黑客攻击和安全事件的响应
- **恶意调试**: 用于恶意目的的调试和分析
- **逆向工程**: 未授权的代码逆向工程

## 最佳实践指南

### 问题描述优化

#### 问题提供策略
- **完整描述**: 提供完整和准确的问题描述
- **重现步骤**: 提供清晰和稳定的重现步骤
- **环境信息**: 提供详细的运行环境信息
- **期望结果**: 明确描述期望的正确行为

#### 错误信息收集
- **完整日志**: 提供完整的错误日志和堆栈信息
- **截图视频**: 提供问题现象的截图或视频
- **时间信息**: 记录问题发生的具体时间和频率
- **上下文**: 提供问题发生时的上下文信息

### 调试过程优化

#### 系统化方法
- **问题分类**: 对问题进行系统化分类和优先级排序
- **假设验证**: 采用科学的假设验证方法
- **逐步排除**: 逐步排除不相关的因素和干扰
- **记录跟踪**: 详细记录调试过程和重要发现

#### 效率提升技巧
- **工具组合**: 合理组合使用不同的调试工具
- **经验复用**: 充分利用以往的调试经验和知识
- **并行分析**: 对多个可能原因进行并行分析
- **快速验证**: 设计快速验证假设的测试方法

### 结果应用优化

#### 修复方案实施
- **渐进修复**: 采用渐进式的修复策略
- **备份恢复**: 做好充分的备份和恢复准备
- **测试验证**: 进行全面的测试和验证
- **文档更新**: 及时更新相关的技术文档

#### 知识积累
- **经验总结**: 及时总结调试经验和教训
- **知识库建设**: 建立和完善调试知识库
- **工具改进**: 基于使用反馈改进调试工具
- **团队分享**: 在团队中分享调试经验和技巧

# 命令执行限制说明

**重要提醒**: 此命令专注于Godot项目的技术调试和问题解决，不涉及产品的商业决策或非技术问题。如需要以下服务，请使用对应的专业命令：

- **代码实现**: 使用 `godot-game-developer` 命令进行新功能开发
- **架构设计**: 使用 `godot-architect` 命令进行系统架构设计
- **性能优化**: 使用 `godot-code-reviewer` 命令进行深度性能分析
- **文档生成**: 使用 `godot-gen-doc` 命令生成技术文档