---
name: godot-gen-code
description: 协作式 Godot 代码生成器
argument-hint: "[编码任务描述]"
---

## 功能说明

采用人机协作的方式完成 Godot 项目编码任务，通过智能任务分解、责任划分和质量控制，确保代码质量和开发效率。

## 执行步骤

1. **任务验证**：
   - 检查用户是否提供了编码任务描述参数
   - 如未提供参数，提示用户详细描述需要完成的编码任务

2. **设计文档检索**：
   - 搜索项目中 `/docs` 目录下的相关设计文档
   - 查找与编码任务 $ARGUMENTS 匹配的现有设计方案

3. **架构设计**：
   - 如未找到相关设计，@godot-architect 根据编码任务创建设计方案 use context7
   - 用一句话简要总结方案核心思路，并请求用户确认
   - 如用户不认可方案，重新设计直到用户满意

4. **任务分解与规划**：
   - @godot-architect 将整体方案分解为具体可执行的子任务
   - 分析任务间的依赖关系，制定最优执行顺序
   - 根据任务性质（可视化 vs 逻辑）进行责任划分

5. **责任分工**：
   - **AI 负责**：GDScript 脚本编写、tscn 文件框架搭建 use context7
   - **用户负责**：tscn 文件细化、动画创建、资源配置（Sprite、碰撞体、字体、颜色等）

6. **执行任务列表**：
   - 生成详细的 todo-list，按照依赖关系顺序执行
   - 对于用户负责的任务：
     * 提供详细的任务说明、操作步骤和完成标准
     * @design-doc-writer 将任务文档输出到 `docs/tasks/` 目录
     * 暂停执行，等待用户确认完成后再继续
   - 对于 AI 负责的任务：
     * @godot-game-developer 根据设计方案编写 GDScript 代码
     * 严格遵守 `gdscript编码规范`
     * @senior-code-reviewer 进行代码审查，消除警告和代码异味

7. **迭代优化**：
   - 按顺序执行所有任务，确保每个任务都达到质量标准
   - 持续优化和完善，直到完全实现编码任务 $ARGUMENTS

## 协作模式

### 责任划分

#### AI 职责（代码实现）
- **游戏逻辑开发**：使用 GDScript 编写核心游戏机制和逻辑
- **场景框架搭建**：创建 tscn 文件的基础结构和节点层次
- **系统架构设计**：设计模块化的代码结构和接口

#### 用户职责（视觉与配置）
- **场景细化**：调整和完善 tscn 文件的视觉表现
- **动画制作**：使用资源资产创建游戏动画效果
- **视觉元素**：创建 Sprite、设置碰撞体、配置视觉效果
- **资源管理**：配置字体、颜色、材质等视觉资源
- **项目设置**：调整项目配置和优化设置

### 开发原则

1. **小步前进**：将复杂任务分解为小步骤，逐步实现和验证
2. **SOLID 原则**：
   - **单一职责**：每个类和函数只负责一个明确的功能
   - **开闭原则**：对扩展开放，对修改封闭
   - **里氏替换**：子类可以替换父类而不影响程序正确性
   - **接口隔离**：使用小而专一的接口，避免臃肿的接口
   - **依赖倒置**：依赖抽象而非具体实现
3. **DRY 原则**：避免代码重复，提高代码的可维护性

## GDScript 编码规范

### 基础规范

#### 文件格式
- **编码**：使用不带 BOM 的 UTF-8 编码
- **换行符**：统一使用 LF（\n）换行，避免使用 CRLF 或 CR
- **文件结尾**：每个文件末尾必须包含一个换行符
- **缩进**：使用制表符（Tab）而非空格进行缩进

#### 代码结构
- **函数与类定义**：用两个空行包围函数和类定义
- **续行缩进**：使用 2 个额外的缩进级别区分续行代码块
- **数组/字典/枚举**：作为例外，仅使用单个缩进级别

#### 命名约定
- **未使用参数**：函数签名中未使用的参数以 `_` 开头
- **自注释代码**：优先使用清晰的命名替代注释
- **日志输出**：避免使用 `print()` 打印日志

### 代码示例

#### 正确的缩进示例
```gdscript
# 基本缩进
for i in range(10):
	pass

# 续行缩进
effect.interpolate_property(sprite, "transform/scale",
		sprite.get_scale(), Vector2(2.0, 2.0), 0.3,
		Tween.TRANS_QUAD, Tween.EASE_OUT)

# 数组/字典续行
var positions = [
	Vector2(0, 0),
	Vector2(100, 50),
	Vector2(-50, 75)
]
```

#### 错误的缩进示例
```gdscript
# 缩进不足
for i in range(10):
print("hello")

# 缩进过度
for i in range(10):
		print("hello")

# 续行缩进不足
effect.interpolate_property(sprite, "transform/scale",
	sprite.get_scale(), Vector2(2.0, 2.0), 0.3,
	Tween.TRANS_QUAD, Tween.EASE_OUT)
```