---
name: web-perf-analysis
description: Web性能分析和优化
argument-hint: "[网站URL或性能问题描述]"
---

## 功能说明

专业的Web性能分析工具，使用Chrome开发者工具进行深度性能分析，提供具体可行的优化建议和实施方案。

## 执行步骤

### 1. 初始化和问题收集
- 检查用户是否提供了网站URL或性能问题描述参数
- 如未提供参数，使用AskUserQuestion询问目标网站URL或具体性能问题
- 使用Explore工具了解项目结构和技术栈背景

### 2. 并行Agent协作启动专业分析
- **问题复杂度评估**: 根据问题描述智能选择分析策略
  - **简单性能问题**（页面加载慢、基础优化）: web-performance-analyst + local-developer组合
  - **中等复杂问题**（特定功能性能、跨浏览器问题）: web-performance-analyst + senior-code-reviewer
  - **复杂架构问题**（系统性性能瓶颈、微服务优化）: 全专家agent协作
  - **代码优化相关**: 优先使用local-developer进行代码实现和基础优化

- **并行分析启动**（同时启动多个agent进行全面分析）:
  * **主要性能分析**: Task工具启动web-performance-analyst代理进行专业性能分析
    - 基于参数 $ARGUMENTS 进行针对性的性能分析
    - 使用chrome-devtools进行全面性能检测
    - 提供详细的性能分析报告和优化建议
  * **并行技术分析组**（同时进行多维度技术分析）:
    - **代码实现分析**: Task工具启动local-developer(qwen3-coder:30b)分析代码优化可行性
      - 识别可立即实施的优化机会
      - 生成具体的优化代码实现建议
    - **代码质量分析**: Task工具启动senior-code-reviewer分析前端代码质量
      - 识别影响性能的代码质量问题
      - 提供代码重构和优化建议
    - **架构影响分析**: Task工具启动相关架构专家进行系统层面分析
      - 分析架构对性能的影响
      - 提供架构级优化方案
  * **辅助分析组**（需要时并行启动）:
    - **多模型验证**: Task工具启动ai-model-advisor通过多模型验证优化方案
    - **趋势分析**: 使用tavily-mcp搜索最新的性能优化技术和趋势

### 3. 并行深度性能检测和分析
- **并行性能追踪组**（同时进行多维度性能检测）:
  * **Chrome DevTools追踪**: 使用chrome-devtools进行全面性能追踪
    - performance_start_trace开始性能追踪
    - 模拟真实用户操作和网络条件
    - performance_stop_trace获取详细的性能数据
    - performance_analyze_insight深入分析性能瓶颈
  * **关键指标并行收集**: 同时收集多类别性能指标
    - Core Web Vitals (LCP, FID, CLS) 指标分析
    - 页面加载时间 (FCP, TTI, TBT) 详细分析
    - 资源加载效率和网络请求分析
    - JavaScript执行性能和内存使用分析
  * **用户体验并行分析**: 同时分析多个用户体验维度
    - 首屏渲染时间和可交互时间分析
    - 页面稳定性和布局偏移分析
    - 用户交互响应性能分析
  * **技术栈特定分析**: 根据项目技术栈进行针对性分析
    - 使用context7获取技术栈特定的性能优化文档
    - 分析框架特定的性能问题和解决方案

### 4. 并行问题根因分析和解决方案设计
- **并行根因分析组**（同时从多个角度分析性能问题）:
  * **主要根因分析**: sequential-thinking工具分析性能数据的根本原因
    - 识别渲染阻塞、网络延迟、JavaScript执行等关键问题
    - 分析不同设备和网络条件下的性能表现
    - 整合多维度数据形成综合根因报告
  * **技术根因分析**: local-developer从技术实现角度分析根因
    - 分析代码层面的性能问题
    - 识别低效的算法和数据结构
    - 定位资源使用不合理的地方
  * **架构根因分析**: senior-code-reviewer从架构角度分析性能瓶颈
    - 分析系统架构对性能的影响
    - 识别设计层面的问题
    - 提供架构级改进建议

- **并行优化方案制定组**（同时制定多层次的优化方案）:
  * **短期优化方案**: Task工具启动local-developer生成立即可实施的优化方案
    - CSS优化、图片压缩、资源合并等立即可实施的改进
    - 生成可直接使用的优化代码片段
    - 提供详细的实施步骤和配置说明
  * **中期优化方案**: Task工具启动web-performance-analyst + local-developer协作制定方案
    - JavaScript性能优化、缓存策略改进
    - 提供详细的实现指导和代码示例
    - 生成模块化的优化实施方案
  * **长期优化方案**: Task工具启动全专家agent协作制定系统性方案
    - 微服务架构优化、数据层重构等需要架构设计的方案
    - 技术栈升级和性能监控体系建设
    - 提供分阶段的实施路线图和风险评估

### 5. 并行多模型验证和专业建议
- **并行验证组**（同时进行多维度验证）:
  * **多模型验证**: Task工具启动multi-model-advisor获取多个AI模型的优化建议
    - 验证优化方案的技术可行性
    - 比较不同优化策略的效果和成本
    - 综合多方面意见制定最佳方案
  * **专业验证组**: 并行启动多个专业领域专家进行方案验证
    - **代码可行性验证**: senior-code-reviewer验证代码实现的可行性和质量
    - **架构一致性验证**: 相关架构专家确保优化方案符合系统架构要求
    - **安全性验证**: 验证优化方案不会引入安全风险
    - **兼容性验证**: 确保优化方案的浏览器和设备兼容性
  * **成本效益分析**: local-developer进行优化成本和效益分析
    - 评估每个优化方案的实施成本
    - 分析预期的性能提升效果
    - 提供优化方案优先级建议

### 6. 并行实施指导和效果验证
- **并行实施指导组**（同时提供多层次实施支持）:
  * **短期实施**: Task工具启动local-developer生成完整的短期优化实施代码
    - 提供可直接复制粘贴的优化代码
    - 包含详细的注释和使用说明
    - 生成测试用例和验证代码
  * **中期实施**: Task工具启动local-developer + web-performance-analyst协作
    - 提供模块化的实施方案和配置指导
    - 生成分步骤的实施计划和检查点
    - 创建实施进度跟踪和验证机制
  * **长期实施**: Task工具启动多专家协作提供全面的实施方案
    - 系统架构重构的详细路线图
    - 风险评估和回滚策略
    - 长期技术演进规划和升级路径

- **并行效果验证组**（同时进行多维度效果验证）:
  * **性能效果验证**: 使用chrome-devtools验证优化效果
    - 进行优化前后的性能对比分析
    - 验证Core Web Vitals指标改善情况
    - 测试不同设备和网络条件下的性能表现
  * **代码质量验证**: senior-code-reviewer验证优化代码的质量
  * **功能完整性验证**: 验证优化后功能的完整性
  * **持续监控建设**: local-developer生成性能监控脚本和工具
    - 建立持续性能监控机制
    - 创建性能报告和分析工具
    - 设置性能阈值和告警机制

### 7. 知识沉淀和文档化
- **分析记录**: 将性能分析过程和结果记录到memory中
- **最佳实践**: 提取性能优化中的有用模式和技巧
- **技术文档**: 使用context7获取相关的性能优化技术文档
- **经验总结**: 建立性能问题的知识库供后续参考

## Agent协作机制

### 主分析流程
1. **web-performance-analyst** 主导整个性能分析流程
2. 根据发现的问题类型，启动相应的专业领域agent
3. 整合多方分析结果，形成综合的优化方案

### 协作场景
- **代码层面问题**: 与senior-code-reviewer协作进行代码质量分析和优化
- **架构层面问题**: 与相关架构专家协作进行系统优化
- **复杂决策问题**: 与ai-model-advisor协作进行多模型验证和建议

## 使用示例

### 网站性能全面分析
```bash
/web-perf-analysis https://example.com
```
- 对指定网站进行全面的性能分析
- 生成详细的性能报告和优化建议

### 性能问题诊断
```bash
/web-perf-analysis "页面加载过慢，特别是移动端"
```
- 针对特定性能问题进行深度分析
- 提供问题根因和解决方案

### 性能优化咨询
```bash
/web-perf-analysis "React应用性能优化"
```
- 针对特定技术栈的性能优化建议
- 提供框架特定的最佳实践

## 特色功能

### 实时浏览器分析
- 使用真实的Chrome浏览器进行性能测试
- 模拟不同设备和网络条件
- 获取真实的用户体验数据

### 多维度性能评估
- Core Web Vitals关键指标分析
- 前端代码质量和架构评估
- 用户体验和交互性能分析
- 跨浏览器兼容性检查

### 智能优化建议
- 基于多模型分析的智能优化建议
- 具体的代码实现和配置示例
- 分阶段的优化实施路线图
- 持续的监控和改进机制

## 输出内容

### 性能分析报告
- **执行摘要**: 关键发现和主要建议
- **性能指标**: Core Web Vitals和详细性能数据
- **问题分析**: 性能瓶颈的根因分析
- **优化建议**: 按优先级排序的具体优化措施

### 实施指导
- **代码示例**: 具体的优化代码实现
- **配置调整**: 工具和服务器配置优化
- **测试验证**: 性能测试和回归测试方案
- **监控设置**: 持续性能监控的配置

通过系统化的性能分析和专业的优化建议，帮助用户显著提升Web应用的性能表现。