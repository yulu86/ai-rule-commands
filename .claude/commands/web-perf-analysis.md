---
name: web-perf-analysis
description: Web性能分析和优化
argument-hint: "[网站URL或性能问题描述]"
---

## 功能说明

专业的Web性能分析工具，使用Chrome开发者工具进行深度性能分析，提供具体可行的优化建议和实施方案。

## 执行步骤

### 1. 初始化和问题收集
- 检查用户是否提供了网站URL或性能问题描述参数
- 如未提供参数，使用AskUserQuestion询问目标网站URL或具体性能问题
- 使用Explore工具了解项目结构和技术栈背景

### 2. Agent协调启动专业分析
- **问题复杂度评估**: 根据问题描述智能选择分析策略
  - **简单性能问题**（页面加载慢、基础优化）: web-performance-analyst + local-developer组合
  - **中等复杂问题**（特定功能性能、跨浏览器问题）: web-performance-analyst + senior-code-reviewer
  - **复杂架构问题**（系统性性能瓶颈、微服务优化）: 全专家agent协作
  - **代码优化相关**: 优先使用local-developer进行代码实现和基础优化

- **主分析启动**: 使用Task工具启动web-performance-analyst代理进行专业性能分析
  - 基于参数 $ARGUMENTS 进行针对性的性能分析
  - 使用chrome-devtools进行全面性能检测
  - 提供详细的性能分析报告和优化建议
- **多维度分析**: 根据分析结果，智能启动相关领域专家agent进行深度分析
  - **代码实现优化**: 使用local-developer(qwen3-coder:30b)生成具体的优化代码实现
  - **代码质量问题**: 启动senior-code-reviewer分析前端代码质量
  - **架构优化需求**: 启动相关架构专家进行系统层面分析
  - **复杂技术决策**: 启动ai-model-advisor通过多模型验证优化方案

### 3. 深度性能检测和分析
- **Chrome DevTools性能追踪**:
  - 使用performance_start_trace开始性能追踪
  - 模拟真实用户操作和网络条件
  - 使用performance_stop_trace获取详细的性能数据
  - 通过performance_analyze_insight深入分析性能瓶颈

- **关键指标收集**:
  - Core Web Vitals (LCP, FID, CLS)
  - 页面加载时间 (FCP, TTI, TBT)
  - 资源加载效率和网络请求分析
  - JavaScript执行性能和内存使用

- **用户体验分析**:
  - 首屏渲染时间和可交互时间
  - 页面稳定性和布局偏移分析
  - 用户交互响应性能

### 4. 问题根因分析和解决方案设计
- **性能瓶颈识别**:
  - 使用sequential-thinking分析性能数据的根本原因
  - 识别渲染阻塞、网络延迟、JavaScript执行等关键问题
  - 分析不同设备和网络条件下的性能表现

- **智能优化方案制定**:
  - **简单优化方案**: 使用local-developer生成具体的代码优化实现
    - CSS优化、图片压缩、资源合并等立即可实施的改进
    - 生成可直接使用的优化代码片段
  - **中等复杂优化**: local-developer + web-performance-analyst协作制定方案
    - JavaScript性能优化、缓存策略改进
    - 提供详细的实现指导和代码示例
  - **复杂架构优化**: 全专家agent协作制定系统性方案
    - 微服务架构优化、数据层重构等需要架构设计的方案
  - **分层实施策略**:
    - 短期优化：立即可实施的性能改进措施
    - 中期重构：需要一定开发时间的架构优化
    - 长期策略：技术栈升级和性能监控体系

### 5. 多模型验证和专业建议
- **方案验证**: 使用multi-model-advisor获取多个AI模型的优化建议
  - 验证优化方案的技术可行性
  - 比较不同优化策略的效果和成本
  - 综合多方面意见制定最佳方案

- **专业审查**: 启动相关领域专家进行方案验证
  - senior-code-reviewer: 验证代码实现的可行性和质量
  - 相关架构专家: 确保优化方案符合系统架构要求

### 6. 智能实施指导和效果验证
- **分层次实施指导**:
  - **简单优化实施**: 使用local-developer生成完整的实施代码
    - 提供可直接复制粘贴的优化代码
    - 包含详细的注释和使用说明
    - 生成测试用例和验证代码
  - **中等复杂实施**: local-developer + web-performance-analyst协作
    - 提供模块化的实施方案和配置指导
    - 生成分步骤的实施计划
  - **复杂架构实施**: 多专家协作提供全面的实施方案
    - 系统架构重构的详细路线图
    - 风险评估和回滚策略

- **效果验证**:
  - 使用chrome-devtools验证优化效果
  - 进行优化前后的性能对比分析
  - 建立持续性能监控机制
  - 使用local-developer生成性能监控脚本和工具

### 7. 知识沉淀和文档化
- **分析记录**: 将性能分析过程和结果记录到memory中
- **最佳实践**: 提取性能优化中的有用模式和技巧
- **技术文档**: 使用context7获取相关的性能优化技术文档
- **经验总结**: 建立性能问题的知识库供后续参考

## Agent协作机制

### 主分析流程
1. **web-performance-analyst** 主导整个性能分析流程
2. 根据发现的问题类型，启动相应的专业领域agent
3. 整合多方分析结果，形成综合的优化方案

### 协作场景
- **代码层面问题**: 与senior-code-reviewer协作进行代码质量分析和优化
- **架构层面问题**: 与相关架构专家协作进行系统优化
- **复杂决策问题**: 与ai-model-advisor协作进行多模型验证和建议

## 使用示例

### 网站性能全面分析
```bash
/web-perf-analysis https://example.com
```
- 对指定网站进行全面的性能分析
- 生成详细的性能报告和优化建议

### 性能问题诊断
```bash
/web-perf-analysis "页面加载过慢，特别是移动端"
```
- 针对特定性能问题进行深度分析
- 提供问题根因和解决方案

### 性能优化咨询
```bash
/web-perf-analysis "React应用性能优化"
```
- 针对特定技术栈的性能优化建议
- 提供框架特定的最佳实践

## 特色功能

### 实时浏览器分析
- 使用真实的Chrome浏览器进行性能测试
- 模拟不同设备和网络条件
- 获取真实的用户体验数据

### 多维度性能评估
- Core Web Vitals关键指标分析
- 前端代码质量和架构评估
- 用户体验和交互性能分析
- 跨浏览器兼容性检查

### 智能优化建议
- 基于多模型分析的智能优化建议
- 具体的代码实现和配置示例
- 分阶段的优化实施路线图
- 持续的监控和改进机制

## 输出内容

### 性能分析报告
- **执行摘要**: 关键发现和主要建议
- **性能指标**: Core Web Vitals和详细性能数据
- **问题分析**: 性能瓶颈的根因分析
- **优化建议**: 按优先级排序的具体优化措施

### 实施指导
- **代码示例**: 具体的优化代码实现
- **配置调整**: 工具和服务器配置优化
- **测试验证**: 性能测试和回归测试方案
- **监控设置**: 持续性能监控的配置

通过系统化的性能分析和专业的优化建议，帮助用户显著提升Web应用的性能表现。