# 架构图生成器示例配置
name: "电商系统架构"
description: "基于微服务的电商平台架构设计"

# 系统架构层级
layers:
  - name: "前端层"
    components:
      - name: "Web应用"
        type: "frontend"
        dependencies: []
      - name: "移动应用"
        type: "frontend"
        dependencies: []
  
  - name: "API网关层"
    components:
      - name: "API网关"
        type: "gateway"
        dependencies: []
      - name: "负载均衡器"
        type: "loadbalancer"
        dependencies: []
  
  - name: "业务服务层"
    components:
      - name: "用户服务"
        type: "service"
        dependencies: []
      - name: "订单服务"
        type: "service"
        dependencies: ["用户服务"]
      - name: "商品服务"
        type: "service"
        dependencies: []
      - name: "支付服务"
        type: "service"
        dependencies: ["订单服务"]
      - name: "通知服务"
        type: "service"
        dependencies: ["订单服务", "用户服务"]
  
  - name: "数据层"
    components:
      - name: "用户数据库"
        type: "database"
        dependencies: []
      - name: "订单数据库"
        type: "database"
        dependencies: []
      - name: "商品数据库"
        type: "database"
        dependencies: []
      - name: "Redis缓存"
        type: "cache"
        dependencies: []
      - name: "消息队列"
        type: "queue"
        dependencies: []

# 外部服务
external_services:
  - name: "支付网关"
    type: "external"
    dependencies: []
  - name: "短信服务"
    type: "external"
    dependencies: []
  - name: "邮件服务"
    type: "external"
    dependencies: []

# 部署环境配置
environments:
  development:
    load_balancer: true
    services:
      - name: "用户服务"
        replicas: 1
      - name: "订单服务"
        replicas: 1
      - name: "商品服务"
        replicas: 1
    databases:
      - name: "MySQL主库"
        type: "database"
      - name: "Redis缓存"
        type: "cache"
  
  production:
    load_balancer: true
    services:
      - name: "用户服务"
        replicas: 3
      - name: "订单服务"
        replicas: 3
      - name: "商品服务"
        replicas: 3
      - name: "支付服务"
        replicas: 2
      - name: "通知服务"
        replicas: 2
    databases:
      - name: "MySQL主库"
        type: "database"
      - name: "MySQL从库"
        type: "database"
      - name: "Redis集群"
        type: "cache"
      - name: "消息队列集群"
        type: "queue"

# 数据流配置
data_flow:
  sources:
    - name: "用户请求"
    - name: "定时任务"
  
  steps:
    - name: "API网关路由"
    - name: "身份认证"
    - name: "业务处理"
    - name: "数据持久化"
    - name: "缓存更新"
  
  stores:
    - name: "MySQL数据库"
    - name: "Redis缓存"
    - name: "消息队列"
    - name: "日志存储"
  
  flows:
    - from: "用户请求"
      to: "API网关路由"
    - from: "API网关路由"
      to: "身份认证"
    - from: "身份认证"
      to: "业务处理"
    - from: "业务处理"
      to: "数据持久化"
    - from: "业务处理"
      to: "缓存更新"

# 时序交互配置
sequence:
  participants:
    - name: "客户端"
    - name: "API网关"
    - name: "用户服务"
    - name: "订单服务"
    - name: "数据库"
  
  steps:
    - type: "request"
      from: "客户端"
      to: "API网关"
      message: "创建订单请求"
    - type: "request"
      from: "API网关"
      to: "用户服务"
      message: "验证用户身份"
    - type: "response"
      from: "用户服务"
      to: "API网关"
      message: "用户验证成功"
    - type: "note"
      participant: "API网关"
      note: "用户身份验证通过"
    - type: "request"
      from: "API网关"
      to: "订单服务"
      message: "处理订单创建"
    - type: "request"
      from: "订单服务"
      to: "数据库"
      message: "保存订单数据"
    - type: "response"
      from: "数据库"
      to: "订单服务"
      message: "保存成功"
    - type: "response"
      from: "订单服务"
      to: "API网关"
      message: "订单创建成功"
    - type: "response"
      from: "API网关"
      to: "客户端"
      message: "返回订单信息"