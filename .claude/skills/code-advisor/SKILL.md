---
name: code-advisor
description: 智能代码助手技能，专门处理代码编写、实现、检视和解释任务。当用户输入"实现代码"、"编写代码"、"输出代码"、"检视代码"、"解释代码"等关键词时触发，使用multi-model-advisor工具调用qwen3-coder:30b模型生成高质量代码，有效减少token消耗。支持多种编程语言的代码生成、代码审查、bug修复和代码解释。智能检测Godot项目并提供针对性的Godot 4.5+特性优化。
---

# 代码智能助手 (Code Advisor)

## 触发条件

当用户输入以下任一关键词时触发此技能：
- "实现代码"
- "编写代码"
- "输出代码"
- "检视代码"
- "解释代码"

## 项目类型检测

### Godot 项目识别
智能检测当前项目是否为 Godot 项目：
- 存在 `project.godot` 文件
- 存在 `.gd`、`.tscn`、`.tres` 文件
- 根据项目类型自动优化处理流程

## 核心工作流程

### 步骤0: 项目类型检测
首先检查当前项目类型：
```bash
# 检测 Godot 项目
if [ -f "project.godot" ] || find . -name "*.gd" -o -name "*.tscn" -o -name "*.tres" | grep -q .; then
  PROJECT_TYPE="godot"
else
  PROJECT_TYPE="general"
fi
```

### 步骤1: 调用Multi-Model Advisor
**必须**使用`mcp__multi-model-advisor__query-models`工具，配置如下：
- **模型**: `qwen3-coder:30b`
- **系统提示**: 根据项目类型和任务类型动态调整：

#### 通用项目系统提示词
- **代码生成**: "你是一个专业的软件开发工程师，擅长编写高质量、可维护的代码。请生成符合最佳实践的代码。"
- **代码检视**: "你是一个资深代码审查专家，擅长发现代码问题、性能瓶颈和安全漏洞。请进行全面的代码审查。"
- **代码解释**: "你是一个技术专家，擅长用清晰易懂的语言解释复杂代码的功能和设计思路。"

#### Godot 项目专用系统提示词
- **代码生成**: "你是一位专业的 Godot 4.5+ 游戏开发工程师，精通 GDScript、场景系统、信号机制和资源管理。请生成符合 Godot 最佳实践的代码，充分利用 Godot 4.5+ 的新特性如 GPU 粒子系统、改进的物理引擎、增强的导入系统等。注意性能优化和内存管理。"
- **代码检视**: "你是一位资深的 Godot 游戏开发专家，擅长 Godot 4.5+ 架构设计、性能优化和最佳实践。请从游戏开发角度审查代码，关注场景结构、信号连接、资源加载、性能优化、内存管理和 Godot 特定的问题。"
- **代码解释**: "你是一位 Godot 技术专家，精通 Godot 4.5+ 的各个系统。请详细解释代码在 Godot 引擎中的工作原理，包括场景树、信号系统、资源生命周期、渲染管线等相关概念。"

### 步骤2: 处理不确定知识

#### 通用项目
如果对代码语法、SDK或相关技术不熟悉：
- 使用`mcp__context7__resolve-library-id`解析库名称
- 使用`mcp__context7__get-library-docs`获取最新文档

#### Godot 项目
如果对 Godot API 或功能不确定：
- 使用`mcp__context7__get-library-docs`获取最新文档
- 使用 Godot MCP server 工具获取项目信息：
  - `mcp__godot__get_project_info`: 获取项目元数据
  - `mcp__godot__get_godot_version`: 获取 Godot 版本
  - `mcp__godot__list_projects`: 列出项目文件
- 对于场景操作，可使用：
  - `mcp__godot__create_scene`: 创建新场景
  - `mcp__godot__add_node`: 添加节点
  - `mcp__godot__load_sprite`: 加载精灵资源

### 步骤3: 输出优化
- 确保输出格式清晰、易读
- 提供必要的注释和说明
- 遵循编码规范和最佳实践

## 任务类型处理

### 通用项目任务

#### 代码实现
- 理解需求并生成完整代码
- 包含必要的错误处理
- 添加适当的注释和文档

#### 代码编写
- 根据 specifications 编写功能代码
- 考虑性能优化和可扩展性
- 遵循特定语言的编码风格

#### 代码检视
- 分析代码质量和结构
- 识别潜在问题和改进点
- 提供具体的优化建议

#### 代码解释
- 解释代码的功能和逻辑
- 分析设计模式和架构思路
- 提供学习价值和最佳实践指导

### Godot 项目专用任务

#### GDScript 代码实现
- 充分利用 Godot 4.5+ 新特性：类型提示、新信号语法、增强的导入系统
- 遵循 Godot 编码规范：节点命名、信号连接、资源管理
- 优化性能：使用 `@onready`、避免不必要的 `get_node()` 调用
- 正确处理场景生命周期：`_ready()`、`_process()`、`_physics_process()`

#### 场景和节点操作
- 推荐合适的节点类型和继承关系
- 优化场景树结构以提高性能
- 实现高效的信号连接和断开
- 使用 Godot 4.5+ 的改进的分组系统

#### 资源管理
- 正确使用 `preload()` 和 `load()`
- 实现资源池化和内存管理
- 利用 Godot 4.5+ 的异步资源加载
- 优化纹理和音频资源导入设置

#### 游戏逻辑检视
- 检查场景循环引用和内存泄漏
- 分析性能瓶颈：绘制调用、物理计算、脚本执行
- 验证信号连接的正确性和安全性
- 优化游戏状态管理和数据流

#### Godot 概念解释
- 详细解释场景树、节点生命周期和信号机制
- 说明 Godot 4.5+ 的新功能和改进
- 解释资源系统、导入设置和优化策略
- 提供游戏开发最佳实践和设计模式建议

## 模型配置优化

### 减少Token消耗策略
1. **精准提问**: 明确具体需求，避免模糊描述
2. **分步处理**: 复杂任务分解为多个小步骤
3. **上下文控制**: 只提供必要的代码上下文
4. **输出精简**: 避免生成冗余的注释和说明

### 系统提示词模板
根据项目类型和任务动态选择合适的系统提示词，确保模型专注于特定任务类型。

## 使用示例

### 通用代码生成场景
用户输入: "实现代码 - 写一个Python函数来计算斐波那契数列"

处理流程:
1. 检测项目类型为通用项目
2. 识别为代码生成任务
3. 调用multi-model-advisor with qwen3-coder:30b
4. 使用通用代码生成系统提示词
5. 输出完整且优化的Python代码

### Godot 代码生成场景
用户输入: "实现代码 - 创建一个玩家控制器脚本，支持8方向移动和动画"

处理流程:
1. 检测项目类型为 Godot 项目
2. 识别为代码生成任务
3. 调用multi-model-advisor with qwen3-coder:30b
4. 使用 Godot 专用代码生成系统提示词
5. 输出符合 Godot 4.5+ 最佳实践的 GDScript 代码
6. 可选：使用 Godot MCP 工具创建相关场景和节点

### Godot 代码审查场景
用户输入: "检视代码 - 请审查这个敌人AI脚本的性能"

处理流程:
1. 检测项目类型为 Godot 项目
2. 识别为代码检视任务
3. 分析提供的 GDScript 代码
4. 调用multi-model-advisor进行专业 Godot 代码审查
5. 从游戏开发角度提供性能和架构建议
6. 可选：使用 Godot MCP 工具检查项目结构

## 注意事项

### 通用规则
- **始终优先使用qwen3-coder:30b模型**
- **保持输出简洁，减少不必要的token消耗**
- **确保代码质量和安全性**

### Godot 项目特殊注意事项
- **智能项目检测**：自动识别 Godot 项目并切换到专用模式
- **充分利用 Godot MCP server**：在需要时使用 Godot 工具进行项目操作
- **Godot 4.5+ 特性**：优先使用最新功能和最佳实践
- **游戏性能优化**：特别关注帧率、内存使用和加载时间
- **场景结构优化**：推荐合理的场景组织架构
- **跨平台兼容性**：确保代码在不同平台上的兼容性

### 技术栈适配
- **不确定技术时主动查询**：
  - 通用技术：使用 context7
  - Godot 特定：使用 Godot MCP server 工具
- **版本兼容性**：确保建议的代码与项目使用的 Godot 版本兼容
- **最佳实践**：提供符合行业标准的游戏开发建议